# Data 분석
### 2023-12-18 ~ 2023-12-22 :
- 번호판 객체 추출 모델(keremberke/yolov5m-license-plate)
- OCR 모델 선정(숫자 4자리 중 최소 3개는 일치)
### 2023-12-26 : 
- 이미지 url을 전달 받아 번호판 추출(추출한 번호판 이미지 저장)
- 추출한 번호판 이미지 화질 개선
- 개선한 이미지로 숫자 추출
- 추출한 번호판 이미지(인코딩 필요)와 숫자 결과 JSON형식으로 전달
### 2023-12-27 :
- 날짜시간, 차량번호 csv파일 전처리 후 DB 저장
### 2023-12-28 : 
- 번호판이 크고 육안으로 숫자가 보이는 113장의 사진으로 모델 성능 측정(4자리 숫자 일치)
    - trocr : 93장 성공(82%)
    - easyocr : 86장 성공(76%)
    - 번호판 인식 실패 : 2장 (원래 번호판 인식 정확도 임계값을 0.7로 제한했었는데 임계값을 없앤 후 인식 성공)
- 번호판이 작고 육안으로 숫자가 보이는 90장의 사진으로 모델 성능 측정(4자리 숫자 일치, 번호판 인식 정확도 임계값 없이)
    - trocr : 75장 성공(83%)
    - easyocr : 24장 성공(26%)
### 2023-12-29 : 
- 번호판이 크고 육안으로 숫자가 보이는 137장의 사진으로 모델 성능 측정(4자리 숫자 일치, 번호판 인식 정확도 임계값 없이)
    - trocr : 120장 성공(87%)
- trocr train시키는 방법 찾기
### 2024-01-02 :
- 트럭 탐지 후 피쳐 뽑아내기
- 트럭 탐지 모델(facebook/detr-resnet-50)
    - 문제 : 트럭을 탐지하는데 작업장의 포크레인이 트럭으로 탐지되고 탐지하려는 트럭의 정확도보다 높게 나옴
    - 해결 : 번호판 추출 모델을 사용하여 번호판 좌표를 추출 후 좌표를 포함하는 트럭만 추출
    - 문제 : 현재 번호판 추출 모델은 가장 정확도가 높은 것만 추출 하는 데 번호판이 아닌 것(포크레인 뒤의 'DOOSAN')이 번호판 보다 정확도가 높게 나옴
    - 번호판이 작고 육안으로 숫자가 보이는 90장의 사진으로 모델 성능 측정
        - 위의 번호판 오인식 문제로 1개의 트럭 탐지 실패(98%)
### 2024-01-03 :
- 트럭 탐지 후 피쳐 뽑아내기(resnet18, resnet50, resnet152)
    - 번호판이 작고 육안으로 숫자가 보이는 90장의 사진으로 89장의 트럭 사진 추출
    - 89장의 트럭 피처 뽑아내서 리스트로 저장
- 피쳐 유사도 측정
    - 번호판이 크고 육안으로 숫자가 보이는 137장의 사진 중 트럭의 번호가 89장의 사진 중 일치하는 62장의 트럭 사진 추출
    - 62장의 트럭 사진 피쳐 뽑아내고 코사인 유사도를 이용하여 89개의 트럭 피쳐 중 가장 유사한 것 찾기
        - resnet18 : 62장의 사진 중 결과가 일치하는 것 10장(16%)
        - resnet50 : 62장의 사진 중 결과가 일치하는 것 16장(25%)
        - resnet152 : 62장의 사진 중 결과가 일치하는 것 18장(29%)
### 2024-01-04 :
- 코사인 유사도 이외에 다른 유사도 측정 방법 사용하기
    - 피쳐 뽑아내는 모델 resnet50 사용
    - Euclidean distance : 62장의 사진 중 결과가 일치하는 것 16장(25%)
    - Jaccard index : 62장의 사진 중 결과가 일치하는 것 2장(3%)
- 차원 줄이기
### 2024-01-05 :
- flask 서버에 truck detection 모델 추가
- 트럭의 배경을 지우고 트럭 머리만 최대한 남긴 후 피쳐 추출
    - 피쳐 뽑아내는 모델 resnet50 사용
    - Euclidean distance : 64장의 사진 중 결과가 일치하는 것 11장(17%)
    - 배경을 지우기 전보다 성능이 떨어짐
### 2024-01-08 :
- 피쳐를 제대로 뽑아내지 못하고 있었음
- 피쳐 뽑아내는 모델 vgg19로 변경(resnet보다 피쳐 뽑아내기 쉬움)
- 번호판이 크고 육안으로 숫자가 보이는 137장 중 ocr인식 실패한 17장으로 피쳐 유사도 측정
    - resnet50 : 6개 성공
    - vgg19 : 4개 성공
### 2024-01-09 :
- 총 69712(11.4GB)장의 사진 중 육안으로 번호판 숫자 4자리 인식이 가능한 사진 9534장 추출(파일 이름 : 숫자 4자리)
### 2024-01-10 :
- 9534장의 사진으로 번호판 추출, 이미지 개선, trocr 모델 돌린 후 성능 측정(1시간 18분 소요)
    - 7430장의 사진 성공(77.9%)
### 2024-01-11 :
- 9534장의 사진 중 사내운영 차량 삭제(90장) 9444장 남음
- 붉은색 번호판 차량 삭제(1장) 9443장 남음
- ocr인식 실패 원인 분석
    - 포크레인 뒤의 DOOSAN이라고 적힌 부분이 차량 번호판 보다 정확도가 크게 나온 경우 : ocr인식 결과에 'DO','NO','SO'가 포함된 경우 그 다음 정확도가 크게나온 번호판 인식으로 해결
    - 사진을 저장하고 다시 불러 올 때 사진데이터가 손상됨 : 사진을 저장, 불러오지 않고 그대로 모델에 넣으면서 진행
### 2024-01-12 :
- flask api 추가 구현
    - 백엔드에 ocr 결과를 리턴
    - ocr 결과가 1자리, 2자리, 3자리 숫자일 때 백엔드에서 DB 조회 후 결과 리스트로 전달 받음
    - 조회 결과 차량의 피쳐만 추출
    - 인풋 차량의 피쳐 추출
    - 유사도 측정 후 가장 유사한 차량의 번호 4자리 리턴 